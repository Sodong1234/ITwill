# [오전수업] DB 18차
## 날짜 연산 함수
- 날짜를 활용한 단순 연산으로는 월 관련 연산이 어려운 부분이 있어 이를 보조해주는 함수들이 제공

### MONTHS_BETWEEN 함수
- 입력한 두 날짜간 차이를 월단위로 계산한 결과를 출력
- 첫번째 인수의 날짜에서 두번재 인수의 값을 빼는 연산으로 결과를 계산하므로 대소관계를 고려하여 값을 입력해준다.

```
* sql*plus, sql Developer에서 사용
SELECT MONTHS_BETWEEN('01-SEP-95', '11-JAN-94')
FROM dual;


* DBeaver의 날짜 양식
SELECT MONTHS_BETWEEN('95-09-01', '94-01-11')
FROM dual;

MONTHS_BETWEEN('95-09-01','94-01-11')    |
-----------------------------------------+
19.67741935483870967741935483870967741935|


--------------------------------------------------------------------------


작은 날짜값이 앞에 있으므로 결과는 음수가 출력된다.
SELECT MONTHS_BETWEEN('94-01-11', '95-09-01')
FROM dual;

MONTHS_BETWEEN('94-01-11','95-09-01')     |
------------------------------------------+
-19.67741935483870967741935483870967741935|
```

### ADD_MONTHS 함수
- 날짜 데이터에 월단위로 이전/이후 날짜를 계산하는 함수
- TO_DATE는 문자열을 날짜데이터로 변환하는 변환함수
```

SELECT TO_DATE('1996-01-31', 'YYYY-MM-DD') + 30, ADD_MONTHS('96-01-31', 1)
FROM dual;

TO_DATE('1996-01-31','YYYY-MM-DD')+30|ADD_MONTHS('96-01-31',1)|
-------------------------------------+------------------------+
              1996-03-01 00:00:00.000| 1996-02-29 00:00:00.000|


--------------------------------------------------------------------------------------------



두번째 인수값을 양수로 작성하면 이후 날짜, 음수로 작성하면 이전 날짜가 연산된다.
SELECT ADD_MONTHS('96-01-31', -11)
FROM dual;

ADD_MONTHS('96-01-31',-11)|
--------------------------+
   1995-02-28 00:00:00.000|
```

### NEXT_DAY 함수
- 특정 날짜 다음 오는 특정 요일 연산하는 함수
```
sql*plus, sql Developer 기준
SELECT NEXT_DAY('01-SEP-95', 'FRIDAY')
FROM dual;


DBeaver 기준
요일은 일요일을 일주일의 첫날로 1로 사용한다. (화 - 2, 수 - 3, …)
SELECT NEXT_DAY('95-09-01', 6)
FROM dual;

NEXT_DAY('95-09-01',6) |
-----------------------+
1995-09-08 00:00:00.000|



-----------------------------------------------------------------------------------



SELECT NEXT_DAY('22-04-07', 6)
FROM dual;

NEXT_DAY('22-04-07',6) |
-----------------------+
2022-04-08 00:00:00.000|
```

### LAST_DAY함수
- 입력한 날짜가 속한 월의 마지막 날을 돌려주는 함수
```

SELECT LAST_DAY('95-02-01')
FROM dual;

LAST_DAY('95-02-01')   |
-----------------------+
1995-02-28 00:00:00.000|
```

### ROUND/TRUNC 함수
- 날짜 데이터에 대한 반올림/버림 연산을 하는 함수
- 숫자의 반올림/버림 연산을 하는 함수와 이름이 같으나 입력되는 데이터가 다르므로 구분 가능
- 날짜 데이터의 요소 중 반올림/버림연산을 할 수 있는 단위로 'YEAR', 'MONTH'를 사용할 수 있음.
```
'MONTH'단위로 반올림하는 경우 월보다 작은 단위인 일/시/분/초/…를 고려하여 절반여부에 따라 올림 또는 버림을 연산하게 된다.
SELECT SYSDATE, ROUND(SYSDATE, 'MONTH')
FROM dual;

SYSDATE                |ROUND(SYSDATE,'MONTH') |
-----------------------+-----------------------+
2022-04-07 10:31:49.000|2022-04-01 00:00:00.000|


----------------------------------------------------------------------------------


SELECT TO_DATE('2022-04-16','YYYY-MM-DD'), 
ROUND(TO_DATE('2022-04-16','YYYY-MM-DD'), 'MONTH') DD
FROM dual;

TO_DATE('2022-04-16','YYYY-MM-DD')|DD                     |
----------------------------------+-----------------------+
           2022-04-16 00:00:00.000|2022-05-01 00:00:00.000|



----------------------------------------------------------------------------------


SELECT SYSDATE, ROUND(SYSDATE, 'YEAR')
FROM dual;

SYSDATE                |ROUND(SYSDATE,'YEAR')  |
-----------------------+-----------------------+
2022-04-07 10:44:07.000|2022-01-01 00:00:00.000|



------------------------------------------------------------------------------------




반올림 단위를 'YEAR'로 하는 경우 년도 단위보다 작은 월/일/시/분/초/…의 값을 고려하여 절반여부에 따라 올림 또는 버림 연산을 하게된다.
SELECT SYSDATE, 
ROUND(TO_DATE('2022-06-25', 'YYYY-MM-DD'), 'YEAR') trunc
FROM dual;

SYSDATE                |TRUNC                  |
-----------------------+-----------------------+
2022-04-07 10:45:14.000|2022-01-01 00:00:00.000|



---------------------------------------------------------------------------------------



SELECT TO_DATE('2022-07-05', 'YYYY-MM-DD'), 
ROUND(TO_DATE('2022-07-05', 'YYYY-MM-DD'), 'YEAR') trunc
FROM dual;

TO_DATE('2022-07-05','YYYY-MM-DD')|TRUNC                  |
----------------------------------+-----------------------+
           2022-07-05 00:00:00.000|2023-01-01 00:00:00.000|



-----------------------------------------------------------------------------------------



TRUNC 함수는 입력한 날짜에 대해서 연산 단위보다 작은 요소값들을 가장 작은값으로 연산한 결과를 출력한다.
SELECT TO_DATE('2022-07-05', 'YYYY-MM-DD'), 
TRUNC(TO_DATE('2022-07-05', 'YYYY-MM-DD'), 'YEAR') trunc
FROM dual;


TO_DATE('2022-07-05','YYYY-MM-DD')|TRUNC                  |
----------------------------------+-----------------------+
           2022-07-05 00:00:00.000|2022-01-01 00:00:00.000|


```
```
SELECT employee_id, hire_date, 
MONTHS_BETWEEN(SYSDATE, hire_date) TENURE,
ADD_MONTHS(hire_date, 6) REVIEW,
NEXT_DAY(hire_date, 6), LAST_DAY(hire_date)
FROM employees
WHERE MONTHS_BETWEEN(SYSDATE, hire_date) < 170;


EMPLOYEE_ID|HIRE_DATE              |TENURE                                  |REVIEW                 |NEXT_DAY(HIRE_DATE,6)  |LAST_DAY(HIRE_DATE)    |
-----------+-----------------------+----------------------------------------+-----------------------+-----------------------+-----------------------+
        128|2008-03-08 00:00:00.000|168.982735588410991636798088410991636798|2008-09-08 00:00:00.000|2008-03-14 00:00:00.000|2008-03-31 00:00:00.000|
        165|2008-02-23 00:00:00.000|169.498864620669056152927120669056152927|2008-08-23 00:00:00.000|2008-02-29 00:00:00.000|2008-02-29 00:00:00.000|
        166|2008-03-24 00:00:00.000|168.466606556152927120669056152927120669|2008-09-24 00:00:00.000|2008-03-28 00:00:00.000|2008-03-31 00:00:00.000|
        167|2008-04-21 00:00:00.000|167.563380749701314217443249701314217443|2008-10-21 00:00:00.000|2008-04-25 00:00:00.000|2008-04-30 00:00:00.000|
        173|2008-04-21 00:00:00.000|167.563380749701314217443249701314217443|2008-10-21 00:00:00.000|2008-04-25 00:00:00.000|2008-04-30 00:00:00.000|




-------------------------------------------------------------------------------------------------------------------------------------------------------




SELECT employee_id, hire_date, 
ROUND(hire_date, 'MONTH'), 
TRUNC(hire_date, 'MONTH')
FROM employees
WHERE hire_date LIKE '%04';

EMPLOYEE_ID|HIRE_DATE              |ROUND(HIRE_DATE,'MONTH')|TRUNC(HIRE_DATE,'MONTH')|
-----------+-----------------------+------------------------+------------------------+
        157|2004-03-04 00:00:00.000| 2004-03-01 00:00:00.000| 2004-03-01 00:00:00.000|
        179|2008-01-04 00:00:00.000| 2008-01-01 00:00:00.000| 2008-01-01 00:00:00.000|
        192|2004-02-04 00:00:00.000| 2004-02-01 00:00:00.000| 2004-02-01 00:00:00.000|

```



연습문제
```
입사일(hire_date)로부터 6개월 뒤 다음 오는 첫 주 금요일은 몇 일인가?


SELECT hire_date, 
NEXT_DAY(LAST_DAY(ADD_MONTHS(hire_date, 6)), 6) review_date
FROM employees
WHERE department_id = 90;

HIRE_DATE              |REVIEW_DATE            |
-----------------------+-----------------------+
2003-06-17 00:00:00.000|2004-01-02 00:00:00.000|
2005-09-21 00:00:00.000|2006-04-07 00:00:00.000|
2001-01-13 00:00:00.000|2001-08-03 00:00:00.000|

```

## 변환함수
- 숫자, 문자, 날짜 데이터 타입간 변환을 할 수 있는 함수
- 모든 데이터를 무조건 변환을 지원하지는 않는다.
- 변환할 수 있는 형식을 갖춘 데이터에 대해서 변환이 가능
- 변환함수를 사용해서 데이터타입을 변환하는 방식을 명시적 형변환.
- 변환함수 없이 데이터베이스가 자동으로 인식해서 형변환하는 방식은 암시적 형변환

![unnamed](https://user-images.githubusercontent.com/95197594/162115633-dd28b738-bb1d-434b-9246-cc4bbb6c764b.png)


### TO_CHAR(날짜 → 문자)
- 날짜 데이터가 가지고 있는 요소(년,월,일,시,…)들을 원하는 형식의 문자열로 변환하여 출력하는 함수
- TO_CHAR(날짜데이터, '형식문자')
```
SELECT employee_id, hire_date,
TO_CHAR(hire_date, 'MM/YY') Month_Hired
FROM employees
WHERE last_name = 'Higgins';

EMPLOYEE_ID|HIRE_DATE              |MONTH_HIRED|
-----------+-----------------------+-----------+
        205|2002-06-07 00:00:00.000|06/02      |
```

### TO_CHAR 형식문자
- 온전한 단어형태의 형식문자
> - YEAR	년도의 영문 스펠링형태
> - MONTH	월의 영문 스펠링형태
> - DAY	요일의 영문 스펠링형태
```
SELECT TO_CHAR(SYSDATE, 'YEAR / MONTH / DAY')
FROM dual;


TO_CHAR(SYSDATE,'YEAR/MONTH/DAY')
--------------------------------------------------------------------------------
TWENTY TWENTY-TWO / APRIL     / THURSDAY
```

- 요소를 3자리의 약어형태로 출력하는 형식
> - MON	월을 3자리의 약어로 표현
> - DY	요일을 3자리의 약어로 표현
```
SELECT TO_CHAR(SYSDATE, 'MON / DY')
FROM dual;


TO_CHAR(SYSDATE,'MON/DY')
---------------------------
APR / THU
```

- 요소 단위의 첫 글자가 반복되는 형식
> - YYYY	년도를 4자리의 숫자로 표현
> - YY	년도를 2자리의 숫자로 표현
> - MM	월을 2자리의 숫자로 표현
> - DD	일을 2자리의 숫자로 표현
> - D	요일을 1자리의 숫자로 표현 (1~7 → 일~토)
```
SELECT TO_CHAR(SYSDATE, 'YYYY / MM / DD')
FROM dual;


TO_CHAR(SYSDAT
--------------
2022 / 04 / 07

SQL> SELECT TO_CHAR(SYSDATE, 'YY / MM / DD')
  2  FROM dual;


--------------------------------------------------------------------


TO_CHAR(SYSD
------------
22 / 04 / 07

SELECT TO_CHAR(SYSDATE, 'YY / MM / D')
FROM dual;


---------------------------------------------------------------------


TO_CHAR(SYS
-----------
22 / 04 / 5
```



---

# [오후수업] JAVA 31차
